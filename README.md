# Описание

Backend-сервисы предназначены для обработки запрос от UI и других сервисов.

Solution делится на следующий части:
1) `Common` - общие библиотеки для всех проектов. В последующем будет выноситься в отдельные nuget-пакеты.
2) `Notification` - микросервис для работы с уведомлениями. Получает шаблон уведомления от `Static`, параметризирует и отправляет на почту через `Exchange`, но если включено параметром, если выключено пишет в лог текст письма.
3) `Security` отвечает за идентификацию, аутентификацию, авторизацию пользователей. Для работы с пользователями интегрируется с `keycloak`.
4) `Static` содержит статичные файлы. Кэширует ответы.  

-------------  
- `Api` могут в зависимостях иметь только два типа проектов: `Contracts` и `Handlers`. Для обработки сервисов извне(например, ui) созданы проекты с постфиксом `Public.Api`, например: `Kortros.Security.Public.Hosts.Api`. Для обработки внутренних запросов создаются проекты с постфиксом `Private.Api`, например: `Kortros.Notification.Private.Hosts.Api`. При этом Public сервисы работают с авторизацией через `Keycloak`, а Private сервисы проверяют доверенные сети
- `Migrations` проекты с миграциями и Seed'ами.
- `Hanlders` имеют в зависимостях `AppSettings`, в которых находятся основные сервисы бизнес-логики. При этом следует заметить, что обработка команд происходит в транзакции и елси требуются вычисления или действия, которые должны выполняться за транзакцией, например отправка уведомления, то необходимо добавлять в `IEventMessageProvider` событие для обработки отправки уведомления(смотреть `UpdateUserRequestHandler`)
- `AppSettings` содержат сервисы для бизнес-логики, могут инжектить `IRepository` для работы с базой данных.
- `Domain` содержат классы сущности таблиц БД.
- `Contracts` содержат контракты для общения с внешними источниками.
- `Clients` содержит реализацию клиентов для доступа к сервису. Данный проект будет публиковаться nuget-пакетом в хранилище для других сервисов, чтобы они могли общаться с этим сервисов посредством обычного вызова метода.
- `Infrastructures.DataAccess` проекты для конфигураций работы с базой данных.
- `Tests` проект с тестами, от этого проекта никто не должен зависеть.

Возможные зависимости между проектами:
|                 | Api | Hanlders | AppSettings | Domain | Contracts | Clients | Infrastructures | Tests |
|-----------------|-----|----------|-------------|--------|-----------|---------|-----------------|-------|
| Api             |  \  |     +    |             |        |     +     |         |                 |       |
| Hanlders        |     |     \    |      +      |        |     +     |    +    |                 |       |
| AppSettings     |     |          |      \      |    +   |     +     |    +    |        +        |       |
| Domain          |     |          |             |    \   |           |         |                 |       |
| Contracts       |     |          |             |        |     \     |         |                 |       |
| Clients         |     |          |             |        |     +     |    \    |                 |       |
| Infrastructures |     |          |             |    +   |           |         |        \        |       |
| Tests           |  +  |     +    |      +      |    +   |     +     |    +    |        +        |   \   |


Проект `AppSettings` внутри себя делит бизнес-логику на контексты, например  в проекте `Security` следующие контексты: 
Внутри контекста логика делится на более мелкие структурные части:
- `Models`: сущности, используемые только в бизнес-логике. Содержит промежуточные классы. Например, партнер содержит большое количество свойств и `Handler` не может передать сущность команды или запроса в сервис, т.к. у `AppService` нет зависимости от `Handler`, поэтому данные мапятся в сущность модели и передаётся в сервис.
- `Services`: логика обработки запроса
- `Factories`: фабрики
- `StateMachines`: машины-состояний
- и т.д.
